---
layout: post
title: Best website translation method
tags:
- gettext
- localisation
- PHP
- Programming
- translate
- _()
status: publish
type: post
published: true
meta:
  _edit_last: '1'
---
Ok your website has grown. You want it in different languages but let's face it, it is a challenging task. I have worked on the process of translating several websites, ground up, and it really isn't hard. It is just quite boring, but easy after all.

My preferred method is by using PHP's built in function <a href="http://php.net/manual/en/book.gettext.php">gettext()</a>. If you are using a shared domain most chances are it is installed. If it isn't, or you run a VPS or dedicated hosting, ask your hosting administrator to install it.

To check whether you have the getttext module installed run the following script:
<pre lang="php">// Check if gettext is ready to use
if(!function_exists("gettext")){
    echo "gettext isn't installed";
}else{
    echo "gettext is supported!";
}</pre>
Well once you see the message <em>gettext is supported!</em> you can carry on
<h2>Setting up localisation:</h2>
We need php to determine the current language. There are many many ways of doing so, however my preferred method is by using subdomains. From the point of view of a Search Engine, your content is new and it has it's own URL, and from your point of view it takes almost no extra effort.

So go to your website control panel if it is shared, if not simply create a new subdomain for each language and point it to the root. I recommend you use the standard <a href="http://urbanoalvarez.es/blog/2008/03/17/iso-639-2-letter-codes/">two-letter code from the ISO 639</a> for each subdomain. For example if my website is http://djs-music.com, I would create the new subdomain for a Spanish version: http://es.djs-music.com (These links are from the latest website I developed, in different languages, so that you can see a working example)

If the default language is English, I wouldn't create a subdomain for that, I would simply leave it as default when there is no subdomain selected.

Now let's create a new php file called <em>local.php,</em> it will handle all this, at the top, we will set up an array with the available languages, the default one... etc

Inside <em>local.php</em> place the following code, it is ready to use so you shouldn't have to change anything:
<pre  lang="php"><?php
/* Localisation script by Alejandro U. Alvarez
 * http://urbanoalvarez.es
 * This has no license actually... But since I am sharing this please be kind, and link back ;)
 *
 * -------------- CONFIGURATION ----------------- *
 */
 
// Write here all possible subdomains
$langs = array('es','en','no');

// Defaults
$defaultlang = 'en';

// Your website with no www
// Place a \ before each .
$webUrl = 'djs-music\.com';

// Your charset/codeset
$codeset = "UTF8";

// Translations folder.
// This is where you will have folders each named with the locale (i.e. en_EN)
// It is recommended you put it in the root and name it locale
$localePath = './locale';

// Translations files name
// This is the name of the .mo files. It is recommended you name them messages.mo
// Inside the localePath there should be one folder per translation
// named with the locale (i.e. en_EN), and inside there should be a .mo file
// preferably called messages.mo Place the name of the file here:
$translationFile = 'messages';

/* ---------- NOW COMES THE ACTUAL CODE --------- */

// intial state
$lang = false;
$local = false;
$defaultLocale = $defaultlang.'_'.strtoupper($defaultlang);
// Get from domain:
$url = parse_url($_SERVER["SERVER_NAME"]);
if(!eregi('^(www\.)*('.$webUrl.')$',$url['path']) ){
	$sub = substr($url['path'], 0, 2); //Returns lang code (2 letter)
	if(in_array($sub,$langs)){
		$local = strtolower($sub).'_'.strtoupper($sub);
		$lang = $sub;
	}
}
if(!$local){
	$local = $defaultLocale;
}
if(!$lang){
	$lang = $defaultLang;
}
$_SESSION['lang'] = $lang;
$_SESSION['locale'] = $local;
// Set locale
// Windows compatibility
putenv('LANG='.$local.'.'.$codeset);
putenv('LANGUAGE='.$local.'.'.$codeset);
bind_textdomain_codeset($translationFile, $codeset); 
// Set locale
putenv('LC_ALL='.$local.'.'.$codeset);
setlocale(LC_ALL, $local.'.'.$codeset);
bindtextdomain($translationFile, $localePath);
textdomain($translationFile);
?></pre>
Everything is explained in comments, so you shouldn't have any problems setting the file up. You should include this as high as possible in your code, but after you start a session with <em>session_start();</em>

Of course at the moment it will not work since we are missing all the important files! So let's move on.
<h2>Setting up our website for translation:</h2>
We now need to indicate which portions of our website are going to be translated. We will do this by wrapping the desired pieces of text in the gettext function, which has an abbreviated name <strong>_()</strong>:
<pre lang="php">echo _('Text to be translated');</pre>
If you need more advanced strings, like text strings that contain variables inside them consider the following example:

I have in my website a text string that reads: <em>echo "You are $years old";</em> This string is special, we cannot translate <em>You are</em>, and then <em>old</em>, because in other languages (Such as Spanish it wouldn't make sense). For cases like this we will use PHP's function <a href="http://php.net/manual/en/function.sprintf.php">sprintf</a>:

(By the way, <em>sprintf </em><strong>returns </strong>the string, <em>printf </em><strong>prints </strong>the string, we use sprintf because we <strong>need</strong> the string <strong>returned</strong> in order to have it translated with gettext)

This function takes at least 2 parameters, the string, and one substitution. How it works is you place "Identifiers" inside the string, that sprintf changes for the corresponding value: Take a look at the previous example with printf:
<pre lang="php">echo _(sprintf("You are %d old",$years));</pre>
Now we can have it translated with the age in the exact position in other languages :)
<h2>Creating the translation folders and files:</h2>
We now need the .mo files that php's gettext uses for the translations. It is very easy as you will see:

If you have already checked the configuration at the top of the <em>local.php</em> file, there were two variables called <em>$localePath</em> and <em>$translationFile</em>, leave these to the defaults for now.

Go to the root of your website and create a new folder called <em>locale</em>, inside this folder, you will have to create one new folder for each language except for the default. So if your website is already in English, and you are going to translate it to Spanish, you should create a new folder inside <em>locale </em>called <em>es_ES</em>.

Now inside each of these folders (In my example inside the folder es_ES) you will have to create another folder called LC_MESSAGES. So your folder structure for the example would look like this:

./
<ul>
	<li>locale
<ul>
	<li>es_ES
<ul>
	<li>LC_MESSAGES</li>
</ul>
</li>
</ul>
</li>
	<li>Other folders and files in your root...</li>
</ul>
Now that the folder structure is set up, we need to get a gettext translation program. Download and install <a href="http://www.poedit.net/download.php">Poedit</a> (Note that it has Windows, Mac and Linux versions, and that it's free)

Once in Poedit, go to File -&gt; <strong>Catalogs manager.</strong> A pop-up window will appear, in it click the blank page icon to create a <strong>New Translations Project</strong>. This is useful to have all your Catalogs for one website under the same project.

When you click on <strong>New Translation project</strong>, a new window appears, enter the name you desire, and in the directories, click on <strong>New Item</strong>, and once there enter the exact path to your project root (i.e. <em>C:\Username\projects\DJs-Music</em> ) And click <strong>Ok</strong>.

Now close that and go to File -&gt; <strong>New Catalog</strong>, a new window will pop up, this is a very important window:

Start in the tab <strong>Project Info</strong> (Default tab)
<ul>
	<li>Project name and version: This is just to help track the translation. You can enter for now <em>Your Website 1.0</em></li>
	<li>Team: Only useful for translations with multiple teams. For example <em>Spanish 1</em></li>
	<li>Email address: Same as before... <em>spanish@yourwebsite.com</em></li>
	<li>Language: Select the language you are going to translate now (For example Spanish)</li>
	<li>Charset: <strong>IMPORTANT</strong> Make sure it matches the charset in your website (Preferably UTF-8)</li>
	<li>Source code charset: Your code charset (It's in the configuration area, preferably UTF-8)</li>
	<li>Plural forms: Leave it blank for now, that is quite advanced for now)</li>
</ul>
Now click on the tab <strong>Paths:</strong> Here you will have to add the paths inside your project where the php files containing strings you want to translate are. Click on the <strong>New Item</strong> icon to add one. If you want to add your root folder for example type <strong>.</strong>

If you want all files inside a folder called<em> /more-files/,</em> enter <em>more-files\.</em>

Forget the tab keywords for now, it is also for more advanced translations.

Click <strong>Ok,</strong> and now click on the<strong> Earth icon, </strong>in the left column (Original string) you should see all the text strings you enclosed between the function <em>_()</em>, if you don't see them go back and check all the previous steps.

Now go on and translate all the strings. To translate simply click on a string on the left column and enter the translation on the box at the bottom of the screen. At the bottom left you will see the translated percentage.

When you are done go to File -&gt; <strong>Save as,</strong> and save it as <em>messages.po</em> inside the <em>LC_MESSAGES</em> folder for the corresponding language locale (So if this was the Spanish translation you would save this file inside <em>locale/es_ES/LC_MESSAGES/</em>)

As well as the <em>messages.po</em> file, you will see if you go to that folder another file called <em>messages.mo,</em> that is the one that you have to upload to your server in order for this to work.
<h2>Check everything:</h2>
Alright so let me walk you through all the steps you should have taken:
<ol>
	<li>Create the file local.php and include it in every file you want to translate</li>
	<li>Create the subdomains and point them to the root</li>
	<li>Configure all the variables in local.php</li>
	<li>Wrap all the text you want to translate in _('<em>Your text here</em>')</li>
	<li>Create the folder structure and the messages.mo files using Poedit</li>
	<li>Upload everything to the server</li>
</ol>
If you did all of this, everything should work fine. You can see a working example of this in DJs Music for example: <a href="http://djs-music.com">English version</a>, <a href="http://es.djs-music.com">Spanish version</a>
<h3>How did this go? Tell me in the comments and ask me any doubt :)</h3>
