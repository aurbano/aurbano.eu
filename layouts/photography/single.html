{{ partial "header" . }}

<div class="accent-line"></div>

<main class="flex-1 py-16">
  <div class="container mx-auto px-8 max-w-[1600px]">
    <!-- Back Link -->
    <a href="/photography/" class="inline-flex items-center gap-2 text-magazine-accent hover:text-magazine-accent-dark font-medium mb-12 transition-colors">
      <i class="fa-solid fa-arrow-left"></i>
      <span>Back to Gallery</span>
    </a>

    <!-- Event Header -->
    <header class="mb-16">
      {{ if .Params.location }}
        <p class="text-2xl text-magazine-black/60 mb-4">{{ .Params.location }}</p>
      {{ end }}

      <h1 class="text-6xl md:text-8xl font-headline font-black mb-6 tracking-wide uppercase text-magazine-accent-dark">
        {{ .Title }}
      </h1>

      <div class="flex items-center gap-4 text-magazine-black/60 mb-8">
        <time class="font-medium">{{ .Date.Format "January 2, 2006" }}</time>
        <span>Â·</span>
        <span>{{ len .Params.photos }} photos</span>
      </div>

      <div class="h-1 w-24 bg-magazine-accent mb-8"></div>

      <!-- Description -->
      <div class="prose prose-lg max-w-none text-magazine-black/80 leading-relaxed">
        {{ .Content }}
      </div>
    </header>
  </div>

  <!-- All Photos Grid - Full Width -->
  {{ if .Params.photos }}
  <div class="w-full px-12 lg:px-24">
    <div class="masonry-grid w-full">
      {{ range $index, $photo := .Params.photos }}
        {{ $thumbUrl := replace $photo.url (path.Ext $photo.url) (printf "__thumb%s" (path.Ext $photo.url)) }}
        <div class="masonry-item relative overflow-hidden bg-magazine-black/5 group cursor-pointer hover:opacity-90 transition-opacity" onclick="openLightbox({{ $index }})">
          <img
            src="{{ $thumbUrl }}"
            alt=""
            class="transition-transform duration-700 group-hover:scale-105"
            loading="lazy"
          />
        </div>
      {{ end }}
    </div>
  </div>
  {{ end }}

  <!-- Instagram Link -->
  <div class="container mx-auto px-8 max-w-[1600px] mt-20 text-center">
    <a href="https://instagram.com/framed_humans" target="_blank" rel="noopener" class="inline-flex items-center gap-3 px-8 py-4 bg-magazine-black text-magazine-white font-bold rounded-full hover:bg-magazine-accent transition-colors">
      <i class="fa-brands fa-instagram text-xl"></i>
      <span>Follow me on Instagram</span>
    </a>
  </div>
</main>

<!-- Lightbox Gallery -->
<div id="lightbox" class="fixed inset-0 bg-magazine-black/95 z-50 hidden items-center justify-center p-8">
  <!-- Close Button -->
  <button class="absolute top-8 right-8 text-magazine-white text-4xl hover:text-magazine-accent transition-colors z-10" onclick="closeLightbox()">
    <i class="fa-solid fa-xmark"></i>
  </button>

  <!-- Previous Button -->
  <button id="prev-btn" class="absolute left-8 top-1/2 -translate-y-1/2 text-magazine-white text-5xl hover:text-magazine-accent transition-colors z-10" onclick="navigateLightbox(-1)">
    <i class="fa-solid fa-chevron-left"></i>
  </button>

  <!-- Image -->
  <img id="lightbox-img" src="" alt="" class="max-w-full max-h-full object-contain" onclick="event.stopPropagation()" />

  <!-- Next Button -->
  <button id="next-btn" class="absolute right-8 top-1/2 -translate-y-1/2 text-magazine-white text-5xl hover:text-magazine-accent transition-colors z-10" onclick="navigateLightbox(1)">
    <i class="fa-solid fa-chevron-right"></i>
  </button>

  <!-- Counter -->
  <div class="absolute bottom-8 left-1/2 -translate-x-1/2 text-magazine-white text-lg font-medium">
    <span id="current-index">1</span> / <span id="total-photos">{{ len .Params.photos }}</span>
  </div>
</div>

<script>
  // Store all photo URLs
  const photos = [
    {{ range .Params.photos }}
      "{{ .url }}",
    {{ end }}
  ];

  let currentIndex = 0;

  function openLightbox(index) {
    currentIndex = index;
    updateLightboxImage();
    const lightbox = document.getElementById('lightbox');
    lightbox.classList.remove('hidden');
    lightbox.classList.add('flex');
    document.body.style.overflow = 'hidden';
  }

  function closeLightbox() {
    const lightbox = document.getElementById('lightbox');
    lightbox.classList.add('hidden');
    lightbox.classList.remove('flex');
    document.body.style.overflow = '';
  }

  function navigateLightbox(direction) {
    currentIndex = (currentIndex + direction + photos.length) % photos.length;
    updateLightboxImage();
  }

  function updateLightboxImage() {
    const img = document.getElementById('lightbox-img');
    const counter = document.getElementById('current-index');
    img.src = photos[currentIndex];
    counter.textContent = currentIndex + 1;
  }

  // Keyboard navigation
  document.addEventListener('keydown', function(e) {
    const lightbox = document.getElementById('lightbox');
    if (!lightbox.classList.contains('hidden')) {
      if (e.key === 'Escape') {
        closeLightbox();
      } else if (e.key === 'ArrowLeft') {
        navigateLightbox(-1);
      } else if (e.key === 'ArrowRight') {
        navigateLightbox(1);
      }
    }
  });

  // Close when clicking outside image
  document.getElementById('lightbox').addEventListener('click', function(e) {
    if (e.target === this) {
      closeLightbox();
    }
  });
</script>

<!-- Masonry.js -->
<script src="https://unpkg.com/masonry-layout@4/dist/masonry.pkgd.min.js"></script>
<script src="https://unpkg.com/imagesloaded@5/imagesloaded.pkgd.min.js"></script>
<script src="/js/masonry-gallery.js"></script>

{{ partial "footer" . }}
