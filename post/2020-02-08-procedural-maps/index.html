<!doctype html><html lang=en-us><head><meta charset=utf-8><title>Procedural Map Generation</title><meta name=description content="A blog by Alejandro U. Alvarez on programming and humans"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=cf-2fa-verify content="521cbed24d30f26"><meta property="og:site_name" content="Alejandro U. Alvarez - Blog"><meta property="og:type" content="article"><meta property="og:title" content="Procedural Map Generation"><meta property="og:description" content="At #socialgorithm we recently started working on a new game, let&rsquo;s call it &ldquo;Ant Colony&rdquo; for now. It&rsquo;s a bit like simplified Age of Empires, where you write the code that drives a bunch of ants, and they need to survive and ultimately be the only ones alive in the map.
We needed to generate map procedurally, which is nothing new really, but it was new to me when I started writing the code for it, so it&rsquo;s been a fun opportunity to learn something new!"><meta property="og:url" content="https://aurbano.eu/post/2020-02-08-procedural-maps/"><meta property="article:published_time" content="2020-02-08 00:00:00 +0000 UTC"><meta property="article:modified_time" content="2020-02-08 00:00:00 +0000 UTC"><meta name=twitter:card content="summary"><meta name=twitter:title content="Procedural Map Generation"><meta name=twitter:description content="At #socialgorithm we recently started working on a new game, let&rsquo;s call it &ldquo;Ant Colony&rdquo; for now. It&rsquo;s a bit like simplified Age of Empires, where you write the code that drives a bunch of ants, and they need to survive and ultimately be the only ones alive in the map.
We needed to generate map procedurally, which is nothing new really, but it was new to me when I started writing the code for it, so it&rsquo;s been a fun opportunity to learn something new!"><meta name=twitter:url content="https://aurbano.eu/post/2020-02-08-procedural-maps/"><meta name=twitter:label1 content="Written by"><meta name=twitter:data1 content="Alejandro U. Alvarez"><script async src="https://www.googletagmanager.com/gtag/js?id=G-BYFMFK4EX1"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-BYFMFK4EX1")</script><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Raleway"><link rel=stylesheet href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/dark.min.css><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA==" crossorigin=anonymous referrerpolicy=no-referrer><link rel=stylesheet href=/css/main.min.2ae91b201b00604bbc7d8b4b6c640ad92f3c3d0b5cccfe88b94d7957e2e0e1ab.css><script src=https://code.jquery.com/jquery-3.4.1.slim.min.js integrity=sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n crossorigin=anonymous></script></head><body class="flex flex-col min-h-screen"><nav class="transition-all duration-300 bg-magazine-white/80 backdrop-blur-md border-b border-magazine-black/5 sticky top-0 z-50 shadow-sm"><div class="container mx-auto px-8 py-6 max-w-7xl"><div class="flex items-center justify-between lg:hidden"><a class="nav-link relative font-medium py-2 px-3 hover:text-magazine-accent transition-colors duration-200 text-xl font-black text-magazine-accent hover:text-magazine-accent-dark" href=/>Alejandro U. Alvarez
</a><button id=navToggle class="p-3 text-magazine-black hover:text-magazine-accent transition-colors" type=button aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<i class="fa-solid fa-bars text-xl"></i></button></div><div class="navbar-collapse hidden lg:flex items-center justify-between w-full" id=navbarSupportedContent><ul class="flex items-center gap-2"><li class="hidden lg:block"><a class="nav-link relative font-medium py-2 px-3 hover:text-magazine-accent transition-colors duration-200 text-xl font-black text-magazine-accent hover:text-magazine-accent-dark" href=/>Alejandro U. Alvarez</a></li><li class="hidden lg:block"><span class="text-magazine-black/20 mx-2">·</span></li><li><a class="nav-link relative font-medium py-2 px-3 hover:text-magazine-accent transition-colors duration-200 text-base" href=/>Home</a></li><li><a class="nav-link relative font-medium py-2 px-3 hover:text-magazine-accent transition-colors duration-200 text-base" href=/about/>About</a></li><li><a class="nav-link relative font-medium py-2 px-3 hover:text-magazine-accent transition-colors duration-200 text-base" href=/photography/>Photography</a></li><li><a class="nav-link relative font-medium py-2 px-3 hover:text-magazine-accent transition-colors duration-200 text-base" href=/post/>All posts</a></li></ul><ul class="flex items-center gap-3"><li><a title=github class="inline-flex items-center justify-center w-10 h-10 rounded-full hover:bg-magazine-accent/10 transition-all duration-200 text-magazine-accent hover:text-magazine-accent-dark text-lg" href=https://github.com/aurbano/ target=_blank rel=noopener><i class="fa-brands fa-github"></i></a></li><li><a title=linkedin class="inline-flex items-center justify-center w-10 h-10 rounded-full hover:bg-magazine-accent/10 transition-all duration-200 text-magazine-accent hover:text-magazine-accent-dark text-lg" href=https://www.linkedin.com/in/aurbano/ target=_blank rel=noopener><i class="fa-brands fa-linkedin"></i></a></li><li><a title=twitter class="inline-flex items-center justify-center w-10 h-10 rounded-full hover:bg-magazine-accent/10 transition-all duration-200 text-magazine-accent hover:text-magazine-accent-dark text-lg" href=https://twitter.com/alalex target=_blank rel=noopener><i class="fa-brands fa-twitter"></i></a></li><li><a title=stack-overflow class="inline-flex items-center justify-center w-10 h-10 rounded-full hover:bg-magazine-accent/10 transition-all duration-200 text-magazine-accent hover:text-magazine-accent-dark text-lg" href=https://stackoverflow.com/users/1262824/aurbano target=_blank rel=noopener><i class="fa-brands fa-stack-overflow"></i></a></li><li><a title=hacker-news class="inline-flex items-center justify-center w-10 h-10 rounded-full hover:bg-magazine-accent/10 transition-all duration-200 text-magazine-accent hover:text-magazine-accent-dark text-lg" href="https://news.ycombinator.com/user?id=aurbano" target=_blank rel=noopener><i class="fa-brands fa-hacker-news"></i></a></li><li><a title=rss class="inline-flex items-center justify-center w-10 h-10 rounded-full hover:bg-magazine-accent/10 transition-all duration-200 text-magazine-accent hover:text-magazine-accent-dark text-lg" href=/index.xml target=_blank rel=noopener><i class="fa-solid fa-rss"></i></a></li></ul></div></div></nav><script>(function(){const e=document.getElementById("navToggle"),t=document.getElementById("navbarSupportedContent");e&&t&&e.addEventListener("click",function(){const e=this.getAttribute("aria-expanded")==="true";t.classList.toggle("hidden"),this.setAttribute("aria-expanded",!e)})})()</script><div class=accent-line></div><main class="flex-1 py-16"><div class="container mx-auto px-8 max-w-4xl"><article><header class=mb-16><div class="text-sm mb-6"><a href=/ class="text-magazine-accent hover:underline">Home</a>
<span class=mx-2>→</span>
<a href=/post class="text-magazine-accent hover:underline">Posts</a></div><h1 class="text-5xl md:text-7xl font-black mb-6 leading-none tracking-tight">Procedural Map Generation</h1><div class="flex flex-wrap items-center justify-between gap-4 pb-6 border-b-2 border-magazine-black/10"><div class="flex items-center gap-4"><time class="inline-block px-4 py-2 bg-magazine-accent text-magazine-white font-bold rounded-full text-sm">February 8, 2020
</time><span class=text-magazine-black/60>7 min read</span></div><a href=https://github.com/aurbano/aurbano.eu/blob/master/content/post/2020-02-08-procedural-maps.md class="text-magazine-black/60 hover:text-magazine-accent transition-colors" title="Edit on GitHub"><i class="fa-solid fa-pencil"></i> Edit</a></div><div class="mt-4 flex flex-wrap gap-2"><a href=https://aurbano.eu//tags/JavaScript class=tag>JavaScript
</a><a href=https://aurbano.eu//tags/Procedural class=tag>Procedural</a></div></header><div class="content prose prose-lg max-w-none"><p>At <a href=https://socialgorithm.org>#socialgorithm</a> we recently started working on a new game, let&rsquo;s call it &ldquo;<strong>Ant Colony</strong>&rdquo; for now. It&rsquo;s a bit like simplified Age of Empires, where you write the code that drives a bunch of ants, and they need to survive and ultimately be the only ones alive in the map.</p><p>We needed to generate map procedurally, which is <a href=https://www.redblobgames.com/maps/terrain-from-noise/>nothing</a> new <a href=https://github.com/Azercoco/3D-Earth-Like-Planet-Procedural-Generator>really</a>, but it was new to me when I started writing the code for it, so it&rsquo;s been a fun opportunity to learn something new!</p><p>I&rsquo;ve seen plenty of noise based terrain generators but unfortunately couldn&rsquo;t find anything where I could quickly test different parameters and ways to use the noise functions, so I decided to build a simple generator with a GUI to control the parameters:</p><p><a href=https://aurbano.github.io/procedural-maps/>Procedural Map Generator</a></p><p>Here are some examples of maps produced using this tool:</p><div class="row no-gutters images"><div class=col-sm><img src=https://aurbano.eu/posts/procedural-maps/img/regular.png>
Grasslands with some rocks/mountains</div><div class=col-sm><img src=https://aurbano.eu/posts/procedural-maps/img/islands.png>
Islands (scaled using the tool itself)</div><div class=col-sm><img src=https://aurbano.eu/posts/procedural-maps/img/forest.png>
Forest</div></div><p>Our requirement for this game is to have at least 3 types of terrain: <strong>Rocks</strong> (block moving), <strong>Grass</strong> (can move freely), and <strong>Water</strong> (slows ants down). It&rsquo;s also important to make something that <em>looks good</em>, because when games are being played everyone will see the map on a big projector.</p><p>The starting point is going to be <a href=https://en.wikipedia.org/wiki/Perlin_noise>Perlin</a> or <a href=https://en.wikipedia.org/wiki/Simplex_noise>Simplex</a> noise. I&rsquo;ll be using <a href=https://github.com/jwagner/simplex-noise.js>simplex-noise.js</a> for this project. Simplex noise was also developed by Ken Perlin, and as far as I know it just has a lower computational complexity.</p><p>If I generate some Simplex 2D noise I get something like the figure below. I have animated the x-axis to highlight the fact that Simplex noise is a continuous function. Another useful property is that it produces exactly the same output for a given seed and coordinate pair. It actually takes too long to generate the noise to be able to have a smooth animation, but in this case it&rsquo;s fine because on each frame I only need to render a [1 x height] rectangle to add on the right, and just shift all the other pixels 1 to the left.</p><p><canvas id=noise style="height:200px;width:100%;border:#ccc solid 1px;margin:1em 0"></canvas></p><p>This means that there&rsquo;s a chance that are you are the only living being to have ever seen the noise distribution moving in front of your eyes right now :)</p><h2 id=turning-noise-into-terrain>Turning noise into terrain</h2><p>This is where it gets slightly complicated. If we were working in 3D we could use the noise values as altitude values, producing pretty cool results.</p><figure><img src=https://aurbano.eu/posts/procedural-maps/img/3d-terrain.png><figcaption><h4>3D elevation mapped from noise</h4></figcaption></figure><p>In 2D we can only play with colors though. A naive approach would be to define some color stops for each noise value, so let&rsquo;s say we normalize our noise to output values in the range [0, 100] and then apply the following color map:</p><ul><li><span style=color:#0a90d8>Water</span> &lt; 20</li><li><span style=color:#cea244>Sand</span> &lt; 22</li><li><span style=color:#59b513>Grass</span> &lt; 80</li><li><span style=color:#393f3e>Mountain</span> &lt; 100</li></ul><p>Here you can play with the elevations for each color:</p><p><canvas id=terrainBasic style="height:200px;width:100%;border:#ccc solid 1px;margin:1em 0"></canvas></p><form><div class=form-group><label for=waterMax>Water</label><br><input type=range class="form-control-range terrainSlider" id=waterMax min=0 max=100 value=20></div><div class=form-group><label for=sandMax>Sand</label><br><input type=range class="form-control-range terrainSlider" id=sandMax min=0 max=100 value=22></div><div class=form-group><label for=grassMax>Grass</label><br><input type=range class="form-control-range terrainSlider" id=grassMax min=0 max=100 value=80></div></form><p>This is a reasonable approach, but if we want to add different types of terrain (dry areas, forest&mldr; ) it becomes too obviously based on noise and won&rsquo;t look realistic. An easy way to get around this is to use two noise maps: elevation and moisture. I got this idea from this <a href=https://www.redblobgames.com/maps/terrain-from-noise/>amazing blog post by Red Blob Games</a>. The idea is that elevation controls mountains and water, but is then combined with a moisture map to determine the type of terrain <strong>in between</strong>.</p><p>The algorithm that I ended up using to generate realistic terrain is this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-typescript data-lang=typescript><span style=display:flex><span><span style=color:#75715e>/**
</span></span></span><span style=display:flex><span><span style=color:#75715e> * Terrain is generated using two noise values, one for elevation and one for moisture
</span></span></span><span style=display:flex><span><span style=color:#75715e> * Elevation determines rocks and water. Moisture is used to introduce variance in the
</span></span></span><span style=display:flex><span><span style=color:#75715e> * space between water and rocks.
</span></span></span><span style=display:flex><span><span style=color:#75715e> *
</span></span></span><span style=display:flex><span><span style=color:#75715e> * Around mountains there should be tall grass
</span></span></span><span style=display:flex><span><span style=color:#75715e> * Forests should appear far from rocks, in places where moisture is not too large
</span></span></span><span style=display:flex><span><span style=color:#75715e> */</span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>getTerrain</span>(<span style=color:#a6e22e>o</span>: <span style=color:#66d9ef>Options</span>, <span style=color:#a6e22e>elevation</span>: <span style=color:#66d9ef>number</span>, <span style=color:#a6e22e>moisture</span>: <span style=color:#66d9ef>number</span>) {
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>e</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>elevation</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>100</span>; <span style=color:#75715e>// elevation [0, 100]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  <span style=color:#66d9ef>const</span> <span style=color:#a6e22e>m</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>moisture</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>100</span>;  <span style=color:#75715e>// moisture [0, 100]
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>e</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>o</span>.<span style=color:#a6e22e>waterMaxElevation</span> <span style=color:#f92672>/</span> <span style=color:#ae81ff>3</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>CELL_TYPES</span>.<span style=color:#a6e22e>DEEP_WATER</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>e</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>o</span>.<span style=color:#a6e22e>waterMaxElevation</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>CELL_TYPES</span>.<span style=color:#a6e22e>WATER</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>e</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>o</span>.<span style=color:#a6e22e>waterMaxElevation</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>o</span>.<span style=color:#a6e22e>sandMaxElevation</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>CELL_TYPES</span>.<span style=color:#a6e22e>SAND</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>e</span> <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>o</span>.<span style=color:#a6e22e>rockMinElevation</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>CELL_TYPES</span>.<span style=color:#a6e22e>ROCK</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>e</span> <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>o</span>.<span style=color:#a6e22e>rockMinElevation</span> <span style=color:#f92672>-</span> <span style=color:#a6e22e>o</span>.<span style=color:#a6e22e>sandMaxElevation</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>CELL_TYPES</span>.<span style=color:#a6e22e>TALL_GRASS</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>m</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>o</span>.<span style=color:#a6e22e>grassMinMoisture</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>CELL_TYPES</span>.<span style=color:#a6e22e>DRY_GRASS</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>e</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>o</span>.<span style=color:#a6e22e>forestMaxElevation</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>m</span> <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>o</span>.<span style=color:#a6e22e>forestMinMoisture</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>m</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>o</span>.<span style=color:#a6e22e>forestMaxMoisture</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>CELL_TYPES</span>.<span style=color:#a6e22e>FOREST</span>;
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>e</span> <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>o</span>.<span style=color:#a6e22e>tallGrassMinElevation</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>m</span> <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>o</span>.<span style=color:#a6e22e>tallGrassMinMoisture</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>CELL_TYPES</span>.<span style=color:#a6e22e>TALL_GRASS</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>CELL_TYPES</span>.<span style=color:#a6e22e>GRASS</span>;
</span></span><span style=display:flex><span>}</span></span></code></pre></div><h2 id=variations>Variations</h2><p>I got curious now about whether I could use noise to generate realistic looking topographic maps. So off we go! First I need an example to try to replicate:</p><figure><img src=https://aurbano.eu/posts/procedural-maps/img/topographic.jpg><figcaption><h4>Some topographic map I found as reference</h4></figcaption></figure><p>Will this be useful? <del>Probably</del>Definitely not. Will it be a fun way to spend a couple hours today Sunday while it rains outside? Definitely yes!</p><p>First I will try to replicate the elevation lines. These should be easy, I could turn the noise output into discrete steps, and just render them as lines. It&rsquo;s not going to be very efficient because I&rsquo;d only be able to draw them pixel by pixel&mldr; I&rsquo;ll think of a solution after.</p><p>One thing that looks very distinctive from the reference map is that there are soft hills and sharp changes in elevation. This obviously depends on the real world terrain and type of landscape, but since I&rsquo;m trying to replicate this reference image I think I&rsquo;ll need to multiply/combine together a couple of different noise maps in order to make it harsher.</p><p><canvas id=elevation style="height:400px;width:100%;border:#ccc solid 1px;margin:1em 0"></canvas></p><p>Well, it&rsquo;s not too bad really! It sometimes generates small areas full of the line color, and sometimes the lines are not as thin as I&rsquo;d like them to be. So if I want to actually replicate that sample I&rsquo;m going to need a different approach&mldr;</p><p>This is the bit that generates the lines right now:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>value1</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>simplexNoise</span>.<span style=color:#a6e22e>noise2D</span>(
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>x</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>elevationScale</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>y</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>elevationScale</span>
</span></span><span style=display:flex><span>) <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>0.5</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>value2</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>simplexNoise</span>.<span style=color:#a6e22e>noise2D</span>(
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>x</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>elevationCanvas</span>.<span style=color:#a6e22e>width</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>2</span>) <span style=color:#f92672>/</span> <span style=color:#a6e22e>elevationScale</span>,
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>y</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>elevationCanvas</span>.<span style=color:#a6e22e>height</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>2</span>) <span style=color:#f92672>/</span> <span style=color:#a6e22e>elevationScale</span>
</span></span><span style=display:flex><span>) <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>0.5</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>value</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>value1</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>value2</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>100</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// draw a line on 10, 20, 30...
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>value</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>&amp;&amp;</span> Math.<span style=color:#a6e22e>floor</span>(<span style=color:#a6e22e>value</span>) <span style=color:#f92672>%</span> <span style=color:#ae81ff>10</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>1</span>) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>elevationCtx</span>.<span style=color:#a6e22e>fillStyle</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>lineColor</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>elevationCtx</span>.<span style=color:#a6e22e>fillRect</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// draw grass sometimes
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>value</span> <span style=color:#f92672>%</span> <span style=color:#ae81ff>10</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>4</span>) {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>elevationCtx</span>.<span style=color:#a6e22e>fillStyle</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>grassColor</span>;
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>elevationCtx</span>.<span style=color:#a6e22e>fillRect</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>y</span>, <span style=color:#ae81ff>1</span>, <span style=color:#ae81ff>1</span>);
</span></span><span style=display:flex><span>}</span></span></code></pre></div><p>On top of the problem with the lines not being actually lines I have the fact that this can only generate very &ldquo;smooth&rdquo; shapes. Multiplying two maps together fixed it a bit, but still doesn&rsquo;t generate sharp turns like the reference. I&rsquo;m thinking using a different scale for the other noise values?</p><p>Two things here: I thought it would be easier to get the elevation lines by drawing pixels at a certain noise level. Turns out it won&rsquo;t look smooth so I&rsquo;d have to first render the image as b&amp;w noise and then maybe &ldquo;walk&rdquo; the image drawing lines at certain transitions? I actually don&rsquo;t know but it feels like it would take ages to get a good result so I&rsquo;m going to continue in a new direction:</p><p>Wild idea: What if I use a noise map as the scale factor for another noise map?</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>value1</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>simplexNoise</span>.<span style=color:#a6e22e>noise2D</span>(
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>x</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>elevationScale</span>,
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>y</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>elevationScale</span>
</span></span><span style=display:flex><span>) <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>0.5</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>value2</span> <span style=color:#f92672>=</span> (<span style=color:#a6e22e>simplexNoise</span>.<span style=color:#a6e22e>noise2D</span>(
</span></span><span style=display:flex><span>  <span style=color:#75715e>// multiply each coordinate by value1 to scale it by it
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>  (<span style=color:#a6e22e>x</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>elevationCanvas</span>.<span style=color:#a6e22e>width</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>2</span>) <span style=color:#f92672>*</span> <span style=color:#a6e22e>value1</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>elevationScale</span>,
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>y</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>elevationCanvas</span>.<span style=color:#a6e22e>height</span> <span style=color:#f92672>*</span> <span style=color:#ae81ff>2</span>) <span style=color:#f92672>*</span> <span style=color:#a6e22e>value1</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>elevationScale</span>
</span></span><span style=display:flex><span>) <span style=color:#f92672>/</span> <span style=color:#ae81ff>2</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>0.5</span>);</span></span></code></pre></div><p>Only one way to know how it&rsquo;ll look! :) I also decided to give this one a more fun color scheme, using the HSL color space and mapping the noise to a number 0-360 so that I can use it directly as the Hue parameter.</p><p><canvas id=scaled style="height:300px;width:100%;border:#ccc solid 1px;margin:1em 0"></canvas></p><form><div class=form-group><label for=scaledScale>Scale</label><br><input type=range class="form-control-range paramSlider" id=scaledScale min=100 max=1000 value=200></div></form><p>Ok at this point I have to admit that I&rsquo;m just having pointless fun, I would love to turn the above into an animation but when I was doing the noise scrolling horizontally at the start of this post I realised that generating the noise took too long for a smooth animation. So there&rsquo;s no way I&rsquo;m getting away with it here, at least not without some tricks.</p><p>In this case these swirls are very similar to using a <a href=https://en.wikipedia.org/wiki/Displacement_mapping>displacement map</a> on a grid of colors, which could be done quite efficiently with WebGl. I&rsquo;ll leave doing that for another day.</p><h2 id=next-steps>Next steps</h2><p>Soon we&rsquo;ll start using this generator in our new game, so I&rsquo;ll update this post if we come up with any improvements.</p><p>You can also follow updates at <a href=https://socialgorithm.org>#socialgorithm</a>, or get in touch if you want to run a coding workshop/competition in your uni, company, school, meetup&mldr;</p><p><script type=text/javascript src=https://aurbano.eu/posts/procedural-maps/js/simplex-noise.js></script><script type=text/javascript src=https://aurbano.eu/posts/procedural-maps/js/render.js></script></p></div><div class=section-divider></div><div class=mt-16><h3 class="text-3xl font-bold mb-8">Related Posts</h3><div class=space-y-0><article class=list-item><div class="flex items-start justify-between gap-4"><div class=flex-1><h6><a href=/post/2020-04-13-dotdot/ class="text-magazine-black hover:text-magazine-accent transition-colors">dotdot: A social experiment</a></h6><p class="text-magazine-black/60 mt-2">Group chat application aiming to help meet and get to know other people</p><div class="flex flex-wrap gap-2 mt-3"><span class="inline-block px-3 py-1 text-xs font-medium bg-magazine-black/5 rounded-full">JavaScript
</span><span class="inline-block px-3 py-1 text-xs font-medium bg-magazine-black/5 rounded-full">Reactjs
</span><span class="inline-block px-3 py-1 text-xs font-medium bg-magazine-black/5 rounded-full">Project</span></div></div><div class="text-right flex-shrink-0"><time class="inline-block px-3 py-1 text-sm font-bold bg-magazine-accent text-magazine-white rounded-full">Apr 2020</time></div></div></article><article class=list-item><div class="flex items-start justify-between gap-4"><div class=flex-1><h6><a href=/post/2020-02-15-flocking-simulation/ class="text-magazine-black hover:text-magazine-accent transition-colors">Flocking Behaviour Simulations</a></h6><p class="text-magazine-black/60 mt-2">JavaScript implementation of the Boid algorithm</p><div class="flex flex-wrap gap-2 mt-3"><span class="inline-block px-3 py-1 text-xs font-medium bg-magazine-black/5 rounded-full">JavaScript
</span><span class="inline-block px-3 py-1 text-xs font-medium bg-magazine-black/5 rounded-full">Procedural
</span><span class="inline-block px-3 py-1 text-xs font-medium bg-magazine-black/5 rounded-full">Journey</span></div></div><div class="text-right flex-shrink-0"><time class="inline-block px-3 py-1 text-sm font-bold bg-magazine-accent text-magazine-white rounded-full">Feb 2020</time></div></div></article><article class=list-item><div class="flex items-start justify-between gap-4"><div class=flex-1><h6><a href=/post/2015-03-03-front-end-sample/ class="text-magazine-black hover:text-magazine-accent transition-colors">Using the latest front-end tech</a></h6><p class="text-magazine-black/60 mt-2">Sample web I've coded to get the latest front end technologies working together.</p><div class="flex flex-wrap gap-2 mt-3"><span class="inline-block px-3 py-1 text-xs font-medium bg-magazine-black/5 rounded-full">JavaScript
</span><span class="inline-block px-3 py-1 text-xs font-medium bg-magazine-black/5 rounded-full">AngularJS</span></div></div><div class="text-right flex-shrink-0"><time class="inline-block px-3 py-1 text-sm font-bold bg-magazine-accent text-magazine-white rounded-full">Mar 2015</time></div></div></article><article class=list-item><div class="flex items-start justify-between gap-4"><div class=flex-1><h6><a href=/post/2014-10-21-making-of-nebula-text/ class="text-magazine-black hover:text-magazine-accent transition-colors">Nebula text: WebGL experiment</a></h6><p class="text-magazine-black/60 mt-2">JavaScript library to render text as floating particles in WebGL</p><div class="flex flex-wrap gap-2 mt-3"><span class="inline-block px-3 py-1 text-xs font-medium bg-magazine-black/5 rounded-full">WebGL
</span><span class="inline-block px-3 py-1 text-xs font-medium bg-magazine-black/5 rounded-full">JavaScript
</span><span class="inline-block px-3 py-1 text-xs font-medium bg-magazine-black/5 rounded-full">Procedural</span></div></div><div class="text-right flex-shrink-0"><time class="inline-block px-3 py-1 text-sm font-bold bg-magazine-accent text-magazine-white rounded-full">Oct 2014</time></div></div></article><article class=list-item><div class="flex items-start justify-between gap-4"><div class=flex-1><h6><a href=/post/2014-10-10-web-visualizer-using-webgl/ class="text-magazine-black hover:text-magazine-accent transition-colors">Web Visualizer using WebGL</a></h6><p class="text-magazine-black/60 mt-2">Building a web visualization tool using some search APIs and VivaGraphJS WebGL renderer</p><div class="flex flex-wrap gap-2 mt-3"><span class="inline-block px-3 py-1 text-xs font-medium bg-magazine-black/5 rounded-full">JavaScript
</span><span class="inline-block px-3 py-1 text-xs font-medium bg-magazine-black/5 rounded-full">WebGL
</span><span class="inline-block px-3 py-1 text-xs font-medium bg-magazine-black/5 rounded-full">Graphs</span></div></div><div class="text-right flex-shrink-0"><time class="inline-block px-3 py-1 text-sm font-bold bg-magazine-accent text-magazine-white rounded-full">Oct 2014</time></div></div></article></div></div></article></div></main><div class="h-1 bg-gradient-to-r from-magazine-accent via-magazine-accent-light to-magazine-secondary"></div><footer class="bg-magazine-accent text-magazine-white"><div class="container mx-auto px-8 max-w-7xl py-12"><div class=text-center><p class="mb-6 text-lg"><a href=/ class="font-black text-magazine-white hover:text-magazine-cream transition-colors text-2xl">Alejandro U. Alvarez</a></p><p class="mb-8 text-magazine-white/70">All rights reserved</p><div class="flex justify-center gap-4 text-sm flex-wrap mb-8"><a href=/index.xml class="hover:text-magazine-cream transition-colors font-medium">RSS</a>
<span class=text-magazine-accent-light>●</span>
<a href=/post class="hover:text-magazine-cream transition-colors font-medium">All posts</a>
<span class=text-magazine-accent-light>●</span>
<a href=/categories class="hover:text-magazine-cream transition-colors font-medium">Categories</a>
<span class=text-magazine-accent-light>●</span>
<a href=/tags class="hover:text-magazine-cream transition-colors font-medium">Tags</a></div><div class="flex justify-center gap-2 mb-6"><div class="w-12 h-px bg-magazine-accent-light"></div><div class="w-12 h-px bg-magazine-cream"></div><div class="w-12 h-px bg-magazine-secondary"></div></div><div class="flex justify-center gap-4"><a href=https://github.com/aurbano/ title=github class="w-10 h-10 flex items-center justify-center rounded-full bg-magazine-white/10 hover:bg-magazine-white hover:text-magazine-accent transition-all duration-300" target=_blank rel=noopener><i class="fa-brands fa-github"></i>
</a><a href=https://www.linkedin.com/in/aurbano/ title=linkedin class="w-10 h-10 flex items-center justify-center rounded-full bg-magazine-white/10 hover:bg-magazine-white hover:text-magazine-accent transition-all duration-300" target=_blank rel=noopener><i class="fa-brands fa-linkedin"></i>
</a><a href=https://twitter.com/alalex title=twitter class="w-10 h-10 flex items-center justify-center rounded-full bg-magazine-white/10 hover:bg-magazine-white hover:text-magazine-accent transition-all duration-300" target=_blank rel=noopener><i class="fa-brands fa-twitter"></i>
</a><a href=https://stackoverflow.com/users/1262824/aurbano title=stack-overflow class="w-10 h-10 flex items-center justify-center rounded-full bg-magazine-white/10 hover:bg-magazine-white hover:text-magazine-accent transition-all duration-300" target=_blank rel=noopener><i class="fa-brands fa-stack-overflow"></i>
</a><a href="https://news.ycombinator.com/user?id=aurbano" title=hacker-news class="w-10 h-10 flex items-center justify-center rounded-full bg-magazine-white/10 hover:bg-magazine-white hover:text-magazine-accent transition-all duration-300" target=_blank rel=noopener><i class="fa-brands fa-hacker-news"></i>
</a><a href=/index.xml title=rss class="w-10 h-10 flex items-center justify-center rounded-full bg-magazine-white/10 hover:bg-magazine-white hover:text-magazine-accent transition-all duration-300" target=_blank rel=noopener><i class="fa-solid fa-rss"></i></a></div></div></div></footer><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/javascript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/typescript.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/java.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/haskell.min.js></script><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/bash.min.js></script><script>hljs.initHighlightingOnLoad()</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script><script>document.addEventListener("DOMContentLoaded",function(){const t=document.querySelector(".navbar-toggler"),e=document.querySelector(".navbar-collapse");t&&e&&(t.addEventListener("click",function(){e.classList.toggle("show")}),document.addEventListener("click",function(n){!t.contains(n.target)&&!e.contains(n.target)&&e.classList.remove("show")}))})</script></body></html>