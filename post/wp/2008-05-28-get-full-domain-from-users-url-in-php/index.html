<!doctype html><html lang=en-us>
<head>
<meta charset=utf-8>
<title>Get full domain from user's URL in php</title>
<meta name=description content="A blog by Alejandro U. Alvarez on programming and humans">
<meta name=viewport content="width=device-width,initial-scale=1">
<meta name=HandheldFriendly content="True">
<meta name=MobileOptimized content="320">
<meta property="og:site_name" content="Alejandro U. Alvarez - Blog">
<meta property="og:type" content="article">
<meta property="og:title" content="Get full domain from user's URL in php">
<meta property="og:description" content="What I'm going to post here is a php function that will create a standard url from a user-inputted url so that any string will be converted to a functioning url.
First it will convert all characters to lowercase:
$url = strtolower($url); Now add http:// if it is not at the beggining:
if(strncasecmp('http://',$url,7) !== 0){ //There is no http:// at the beginning: 	$url = 'http://'.$url; } What strncasecmp does is it takes a string, and then a number.">
<meta property="og:url" content="https://aurbano.eu/post/wp/2008-05-28-get-full-domain-from-users-url-in-php/">
<meta property="article:published_time" content="2008-05-28 00:00:00 +0000 UTC">
<meta property="article:modified_time" content="2008-05-28 00:00:00 +0000 UTC">
<meta name=twitter:card content="summary">
<meta name=twitter:title content="Get full domain from user's URL in php">
<meta name=twitter:description content="What I'm going to post here is a php function that will create a standard url from a user-inputted url so that any string will be converted to a functioning url.
First it will convert all characters to lowercase:
$url = strtolower($url); Now add http:// if it is not at the beggining:
if(strncasecmp('http://',$url,7) !== 0){ //There is no http:// at the beginning: 	$url = 'http://'.$url; } What strncasecmp does is it takes a string, and then a number.">
<meta name=twitter:url content="https://aurbano.eu/post/wp/2008-05-28-get-full-domain-from-users-url-in-php/">
<meta name=twitter:label1 content="Written by">
<meta name=twitter:data1 content="Alejandro U. Alvarez">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-BYFMFK4EX1"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-BYFMFK4EX1')</script>
<link rel=stylesheet href="https://fonts.googleapis.com/css?family=Raleway">
<link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/dark.min.css>
<link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css integrity=sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN crossorigin=anonymous>
<link rel=stylesheet href=https://aurbano.eu/main.min.bd4ab2352da1c81d0e8c42e44426d056ba02a8e5fdb03a180c10d2cf90464823.css>
<script src=https://code.jquery.com/jquery-3.4.1.slim.min.js integrity=sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n crossorigin=anonymous></script>
</head>
<body>
<nav class="navbar navbar-expand-lg">
<div class=container>
<button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span>
</button>
<div class="collapse navbar-collapse" id=navbarSupportedContent>
<ul class="navbar-nav nav-menu mr-auto">
<li class=nav-item>
<a class=nav-link href=/ style=font-weight:700>
Alejandro U. Alvarez
</a>
</li>
<li class=nav-item>
<a class=nav-link href=/> Home </a>
</li>
<li class=nav-item>
<a class=nav-link href=/about/> About </a>
</li>
<li class=nav-item>
<a class=nav-link href=/post/> All posts </a>
</li>
</ul>
<ul class="navbar-nav social-icons">
<li class=nav-item>
<a title="github profile" class="nav-link text-github" href=https://github.com/aurbano/>
<i class="fa fa-github"></i>
</a>
</li>
<li class=nav-item>
<a title="linkedin profile" class="nav-link text-linkedin" href=https://www.linkedin.com/in/aurbano/>
<i class="fa fa-linkedin"></i>
</a>
</li>
<li class=nav-item>
<a title="twitter profile" class="nav-link text-twitter" href=https://twitter.com/alalex>
<i class="fa fa-twitter"></i>
</a>
</li>
<li class=nav-item>
<a title="stack-overflow profile" class="nav-link text-stack-overflow" href=https://stackoverflow.com/users/1262824/aurbano>
<i class="fa fa-stack-overflow"></i>
</a>
</li>
<li class=nav-item>
<a title="hacker-news profile" class="nav-link text-hacker-news" href="https://news.ycombinator.com/user?id=aurbano">
<i class="fa fa-hacker-news"></i>
</a>
</li>
<li class=nav-item>
<a title="rss profile" class="nav-link text-rss" href=/index.xml>
<i class="fa fa-rss"></i>
</a>
</li>
</ul>
</div>
</div>
</nav>
<main>
<div class=container>
<div class="row justify-content-md-center">
<div class="col col-lg-8">
<header>
<h1>Get full domain from user's URL in php</h1>
<div class=row>
<div class=col>
<small class="date text-muted">
Published on May 28, 2008
</small>
<a href=https://aurbano.eu/tags/PHP class=item-tag>
PHP
</a>
</div>
<div class="col-2 text-right">
<a href=https://github.com/aurbano/aurbano.eu/blob/master/content/post/wp/2008-05-28-get-full-domain-from-users-url-in-php.md class=edit title="Open this post on Github">
<i class="fa fa-pencil"></i>
</a>
</div>
</div>
</header>
<div class="alert alert-warning mt-4" role=alert>
<b>Here be dragons!</b> <br>
I wrote this ages ago and is very likely outdated
<del>(and absolute crap)</del>. Time flies!
</div>
<div align=start class=content><p>What I'm going to post here is a php function that will create a standard url from a user-inputted url so that any string will be converted to a functioning url.</p>
<p>First it will convert all characters to lowercase:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php>$url <span style=color:#f92672>=</span> <span style=color:#a6e22e>strtolower</span>($url);
</code></pre></div><p>Now add http:// if it is not at the beggining:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>strncasecmp</span>(<span style=color:#e6db74>&#39;http://&#39;</span>,$url,<span style=color:#ae81ff>7</span>) <span style=color:#f92672>!==</span> <span style=color:#ae81ff>0</span>){
	<span style=color:#75715e>//There is no http:// at the beginning:
</span><span style=color:#75715e></span>	$url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;http://&#39;</span><span style=color:#f92672>.</span>$url;
}
</code></pre></div><p>What <code>strncasecmp</code> does is it takes a string, and then a number. It then checks to see if that string is contained within the first (That second parameter) characters contain it. It returns 0 if it is found.<br>
So in the example it checks to see if http:// is there, and if it is not, it adds it.</p>
<p>Now strip all folders (This is optional, but here I will show how to make sure only the main domain is left</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php>$parts <span style=color:#f92672>=</span> <span style=color:#a6e22e>explode</span>(<span style=color:#e6db74>&#39;/&#39;</span>,$url);
<span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>sizeof</span>($parts) <span style=color:#f92672>!==</span> <span style=color:#ae81ff>1</span>){
	<span style=color:#75715e>//no / in the string: (No http, no ending /)
</span><span style=color:#75715e></span>	$url <span style=color:#f92672>=</span> $parts[<span style=color:#ae81ff>2</span>];
}
</code></pre></div><p>So now we've got something like "http://{user_input}/".<br>
Let's make sure it has (or not) www. And if not, let's add it (Just for consistency)</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>strncasecmp</span>(<span style=color:#e6db74>&#39;www.&#39;</span>,$url,<span style=color:#ae81ff>4</span>) <span style=color:#f92672>!==</span> <span style=color:#ae81ff>0</span>){
	<span style=color:#75715e>//There is no www.
</span><span style=color:#75715e></span>	<span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#39;http://www.&#39;</span><span style=color:#f92672>.</span>$url<span style=color:#f92672>.</span><span style=color:#e6db74>&#39;/&#39;</span>;
}<span style=color:#66d9ef>else</span>{
	<span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#39;http://&#39;</span><span style=color:#f92672>.</span>$url<span style=color:#f92672>.</span><span style=color:#e6db74>&#39;/&#39;</span>;
}
</code></pre></div><p>Now we have "http://www.{user input}/" , we are basically done!<br>
If you really want to this this correctly you could check if the URL exists, but this is just a waste of bandwidth and opens a door for attacks from my point of view&mldr;<br>
So if you want to do this, create the following function:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>url_exists</span>($strURL) {
    $resURL <span style=color:#f92672>=</span> <span style=color:#a6e22e>curl_init</span>();
    <span style=color:#a6e22e>curl_setopt</span>($resURL, <span style=color:#a6e22e>CURLOPT_URL</span>, $strURL);
    <span style=color:#a6e22e>curl_setopt</span>($resURL, <span style=color:#a6e22e>CURLOPT_BINARYTRANSFER</span>, <span style=color:#ae81ff>1</span>);
    <span style=color:#a6e22e>curl_setopt</span>($resURL, <span style=color:#a6e22e>CURLOPT_HEADERFUNCTION</span>, <span style=color:#e6db74>&#39;curlHeaderCallback&#39;</span>);
    <span style=color:#a6e22e>curl_setopt</span>($resURL, <span style=color:#a6e22e>CURLOPT_FAILONERROR</span>, <span style=color:#ae81ff>1</span>);

    <span style=color:#a6e22e>curl_exec</span> ($resURL);

    $intReturnCode <span style=color:#f92672>=</span> <span style=color:#a6e22e>curl_getinfo</span>($resURL, <span style=color:#a6e22e>CURLINFO_HTTP_CODE</span>);
    <span style=color:#a6e22e>curl_close</span> ($resURL);

    <span style=color:#66d9ef>if</span> ($intReturnCode <span style=color:#f92672>!=</span> <span style=color:#ae81ff>200</span> <span style=color:#f92672>&amp;&amp;</span> $intReturnCode <span style=color:#f92672>!=</span> <span style=color:#ae81ff>302</span> <span style=color:#f92672>&amp;&amp;</span> $intReturnCode <span style=color:#f92672>!=</span> <span style=color:#ae81ff>304</span>) {
       <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
    }<span style=color:#66d9ef>Else</span>{
        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span> ;
    }
} 
</code></pre></div><p>And call it from our previous script:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>url_exists</span>($url)) {
     <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span>;
}<span style=color:#66d9ef>else</span>{
    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
}
</code></pre></div><h3 id=full-code-now>Full code now:</h3>
<p>So the whole thing would be something like this:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-php data-lang=php><span style=color:#75715e>//Function to make main domain from url:
</span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>url_exists</span>($strURL) {
    $resURL <span style=color:#f92672>=</span> <span style=color:#a6e22e>curl_init</span>();
    <span style=color:#a6e22e>curl_setopt</span>($resURL, <span style=color:#a6e22e>CURLOPT_URL</span>, $strURL);
    <span style=color:#a6e22e>curl_setopt</span>($resURL, <span style=color:#a6e22e>CURLOPT_BINARYTRANSFER</span>, <span style=color:#ae81ff>1</span>);
    <span style=color:#a6e22e>curl_setopt</span>($resURL, <span style=color:#a6e22e>CURLOPT_HEADERFUNCTION</span>, <span style=color:#e6db74>&#39;curlHeaderCallback&#39;</span>);
    <span style=color:#a6e22e>curl_setopt</span>($resURL, <span style=color:#a6e22e>CURLOPT_FAILONERROR</span>, <span style=color:#ae81ff>1</span>);

    <span style=color:#a6e22e>curl_exec</span> ($resURL);

    $intReturnCode <span style=color:#f92672>=</span> <span style=color:#a6e22e>curl_getinfo</span>($resURL, <span style=color:#a6e22e>CURLINFO_HTTP_CODE</span>);
    <span style=color:#a6e22e>curl_close</span> ($resURL);

    <span style=color:#66d9ef>if</span> ($intReturnCode <span style=color:#f92672>!=</span> <span style=color:#ae81ff>200</span> <span style=color:#f92672>&amp;&amp;</span> $intReturnCode <span style=color:#f92672>!=</span> <span style=color:#ae81ff>302</span> <span style=color:#f92672>&amp;&amp;</span> $intReturnCode <span style=color:#f92672>!=</span> <span style=color:#ae81ff>304</span>) {
       <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
    }<span style=color:#66d9ef>Else</span>{
        <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>true</span> ;
    }
} 
<span style=color:#75715e>//And now the function
</span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>domain</span>($url,$checkIfExists<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>){
	<span style=color:#75715e>//This function creates a url in the form http://www.domain.com/
</span><span style=color:#75715e></span>	$url <span style=color:#f92672>=</span> <span style=color:#a6e22e>strtolower</span>($url);
	<span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>strncasecmp</span>(<span style=color:#e6db74>&#39;http://&#39;</span>,$url,<span style=color:#ae81ff>7</span>) <span style=color:#f92672>!==</span> <span style=color:#ae81ff>0</span>){
		<span style=color:#75715e>//There is no http:// at the beginning:
</span><span style=color:#75715e></span>		$url <span style=color:#f92672>=</span> <span style=color:#e6db74>&#39;http://&#39;</span><span style=color:#f92672>.</span>$url;
	}
	$parts <span style=color:#f92672>=</span> <span style=color:#a6e22e>explode</span>(<span style=color:#e6db74>&#39;/&#39;</span>,$url);
	<span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>sizeof</span>($parts) <span style=color:#f92672>!==</span> <span style=color:#ae81ff>1</span>){
		<span style=color:#75715e>//no / in the string: (No http, no ending /)
</span><span style=color:#75715e></span>		$url <span style=color:#f92672>=</span> $parts[<span style=color:#ae81ff>2</span>];
	}
	<span style=color:#75715e>//Now check if the url has or not www. in it:
</span><span style=color:#75715e></span>	<span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>strncasecmp</span>(<span style=color:#e6db74>&#39;www.&#39;</span>,$url,<span style=color:#ae81ff>4</span>) <span style=color:#f92672>!==</span> <span style=color:#ae81ff>0</span>){
		<span style=color:#75715e>//There is no www.
</span><span style=color:#75715e></span>		<span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#39;http://www.&#39;</span><span style=color:#f92672>.</span>$url<span style=color:#f92672>.</span><span style=color:#e6db74>&#39;/&#39;</span>;
	}<span style=color:#66d9ef>else</span>{
		<span style=color:#66d9ef>return</span> <span style=color:#e6db74>&#39;http://&#39;</span><span style=color:#f92672>.</span>$url<span style=color:#f92672>.</span><span style=color:#e6db74>&#39;/&#39;</span>;
	}
	<span style=color:#66d9ef>if</span>($checkIfExists <span style=color:#f92672>!==</span> <span style=color:#ae81ff>0</span>){
		<span style=color:#75715e>//User wanted to check if exists:
</span><span style=color:#75715e></span>		<span style=color:#66d9ef>If</span>(<span style=color:#a6e22e>url_exists</span>($url)) {
			<span style=color:#66d9ef>return</span> $url;
		}<span style=color:#66d9ef>else</span>{
			<span style=color:#66d9ef>return</span> <span style=color:#66d9ef>false</span>;
		}
	}
}
</code></pre></div></div>
<div class="card related shadow">
<div class=card-body>
<h5 class=card-title>More like this:</h5>
<div class=item>
<h6>
<a href=/post/wp/2009-01-20-display-time-since-last-visit-in-php/>Display time since last visit in PHP</a>
<small class="date text-muted">January 20, 2009</small>
</h6>
<p class=text-muted></p>
</div>
<div class=item>
<h6>
<a href=/post/wp/2008-09-11-assign-image-to-wordpress-post/>Easily assign an image to a post in WordPress</a>
<small class="date text-muted">September 11, 2008</small>
</h6>
<p class=text-muted></p>
</div>
<div class=item>
<h6>
<a href=/post/wp/2008-05-30-did-you-mean-in-php/>Did you mean? In php</a>
<small class="date text-muted">May 30, 2008</small>
</h6>
<p class=text-muted></p>
</div>
</div>
</div>
</div>
</div>
</div>
</main>
<footer>
<p class="copyright text-muted">
<a href=/>Alejandro U. Alvarez</a>
© All rights reserved
&bull;
<a href=/index.xml>
RSS
</a>
&bull;
<a href=/post>
All posts
</a>
&bull;
<a href=/categories>
Categories
</a>
&bull;
<a href=/tags>
Tags
</a>
</p>
</footer>
<div class="border animated-hue"></div>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/javascript.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/typescript.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/java.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/haskell.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/bash.min.js></script>
<script>hljs.initHighlightingOnLoad()</script>
<script src=https://aurbano.eu/vendor/bootstrap/dist/js/bootstrap.bundle.min.js></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script>
<script>$(document).on('click',function(){$('.collapse').collapse('hide')})</script>
</body>
</html>