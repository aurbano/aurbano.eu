<!doctype html><html lang=en-us><head><meta charset=utf-8><title>Nebula text: WebGL experiment</title><meta name=description content="A blog by Alejandro U. Alvarez on programming and humans"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta property="og:site_name" content="Alejandro U. Alvarez - Blog"><meta property="og:type" content="article"><meta property="og:title" content="Nebula text: WebGL experiment"><meta property="og:description" content="When I was doing the Tree Generator, I used dat.gui for the first time, and on their workshop they have the following text to play with:
 dat.gui -    This gave me the idea to render text on the canvas using particles that would seem to be gravitating around, in such a way that when seen all together you would see the text.
Example: &ldquo;hey&rdquo;    Click for explosions   For this example I set a big drag force so that the particles would settle fast and you could read the text more easily."><meta property="og:url" content="https://aurbano.eu/post/2014-10-21-making-of-nebula-text/"><meta property="article:published_time" content="2014-10-21 00:00:00 +0000 UTC"><meta property="article:modified_time" content="2014-10-21 00:00:00 +0000 UTC"><meta name=twitter:card content="summary"><meta name=twitter:title content="Nebula text: WebGL experiment"><meta name=twitter:description content="When I was doing the Tree Generator, I used dat.gui for the first time, and on their workshop they have the following text to play with:
 dat.gui -    This gave me the idea to render text on the canvas using particles that would seem to be gravitating around, in such a way that when seen all together you would see the text.
Example: &ldquo;hey&rdquo;    Click for explosions   For this example I set a big drag force so that the particles would settle fast and you could read the text more easily."><meta name=twitter:url content="https://aurbano.eu/post/2014-10-21-making-of-nebula-text/"><meta name=twitter:label1 content="Written by"><meta name=twitter:data1 content="Alejandro U. Alvarez"><script async src="https://www.googletagmanager.com/gtag/js?id=G-BYFMFK4EX1"></script>
<script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-BYFMFK4EX1")</script><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Raleway"><link rel=stylesheet href=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/dark.min.css><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css integrity=sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN crossorigin=anonymous><link rel=stylesheet href=https://aurbano.eu/main.min.62938ec46c15d6ef97891adadcd35df795e5f051d329cf462f3fc22b5ff6d7f0.css><script src=https://code.jquery.com/jquery-3.4.1.slim.min.js integrity=sha384-J6qa4849blE2+poT4WnyKhv5vZF5SrPo0iEjwBvKU7imGFAV0wwj1yYfoRSJoZ+n crossorigin=anonymous></script></head><body><nav class="navbar navbar-expand-lg"><div class=container><button class=navbar-toggler type=button data-toggle=collapse data-target=#navbarSupportedContent aria-controls=navbarSupportedContent aria-expanded=false aria-label="Toggle navigation">
<span class=navbar-toggler-icon></span></button><div class="collapse navbar-collapse" id=navbarSupportedContent><ul class="navbar-nav nav-menu mr-auto"><li class=nav-item><a class=nav-link href=/ style=font-weight:700>Alejandro U. Alvarez</a></li><li class=nav-item><a class=nav-link href=/>Home</a></li><li class=nav-item><a class=nav-link href=/about/>About</a></li><li class=nav-item><a class=nav-link href=/post/>All posts</a></li></ul><ul class="navbar-nav social-icons"><li class=nav-item><a title="github profile" class="nav-link text-github" href=https://github.com/aurbano/><i class="fa fa-github"></i></a></li><li class=nav-item><a title="linkedin profile" class="nav-link text-linkedin" href=https://www.linkedin.com/in/aurbano/><i class="fa fa-linkedin"></i></a></li><li class=nav-item><a title="twitter profile" class="nav-link text-twitter" href=https://twitter.com/alalex><i class="fa fa-twitter"></i></a></li><li class=nav-item><a title="stack-overflow profile" class="nav-link text-stack-overflow" href=https://stackoverflow.com/users/1262824/aurbano><i class="fa fa-stack-overflow"></i></a></li><li class=nav-item><a title="hacker-news profile" class="nav-link text-hacker-news" href="https://news.ycombinator.com/user?id=aurbano"><i class="fa fa-hacker-news"></i></a></li><li class=nav-item><a title="rss profile" class="nav-link text-rss" href=/index.xml><i class="fa fa-rss"></i></a></li></ul></div></div></nav><main><div class=container><div class="row justify-content-md-center"><div class="col col-lg-8"><header><h1>Nebula text: WebGL experiment</h1><div class=row><div class=col><small class="date text-muted">Published on October 21, 2014</small>
<a href=https://aurbano.eu/tags/WebGL class=item-tag>WebGL</a>
<a href=https://aurbano.eu/tags/JavaScript class=item-tag>JavaScript</a>
<a href=https://aurbano.eu/tags/Procedural class=item-tag>Procedural</a></div><div class="col-2 text-right"><a href=https://github.com/aurbano/aurbano.eu/blob/master/content/post/2014-10-21-making-of-nebula-text.md class=edit title="Open this post on Github"><i class="fa fa-pencil"></i></a></div></div></header><div align=start class=content><p>When I was doing the <a href=/blog/2013/01/14/procedurally-generated-trees-in-javascript/>Tree Generator</a>, I used <a href=https://code.google.com/p/dat-gui/>dat.gui</a> for the first time, and on their workshop they have the following text to play with:</p><figure><img src=/assets/files/posts/nebula/datgui.png><figcaption><h4>dat.gui -</h4></figcaption></figure><p>This gave me the idea to render text on the canvas using particles that would seem to be gravitating around, in such a way that when seen all together you would see the text.</p><h3 id=example-hey>Example: &ldquo;hey&rdquo;</h3><figure><div style=width:100%;height:300px id=nebulaDemo></div><figcaption><h4>Click for explosions</h4></figcaption></figure><p>For this example I set a big <code>drag</code> force so that the particles would settle fast and you could read the text more easily. On larger sizes it actually looks better withouth any <code>drag</code> force.</p><h3 id=demos>Demos</h3><ul><li><a href=https://aurbano.github.io/Nebula/>Main demo</a>: Sample demo with dat.gui controls to play with the settings.</li><li><a href=https://aurbano.github.io/Nebula/music.html>Music Nebula</a>: Nebula instance synced with an audio track for explosions.</li></ul><h1 id=first-steps>First steps</h1><p>I initially did this experiment <a href=https://aurbano.github.io/Nebula/canvas.html>on the canvas</a> without any rendering engine. This has the advantage of rapid prototyping, and the disadvantage of likely performance issues. I managed to make it work quite well though, but the number of nodes it could render was limited by the browser JavaScript interpreter.</p><p>The basic idea is to have a number of particles gravitate towards a point, in such a way that the points represent the text:</p><figure><img src=/assets/files/posts/nebula/edges.png><figcaption><h4>edges - Points around which the particles gravitate.</h4></figcaption></figure><p>This was actually trickier than it seems, because there is no built in way to get a list of coordinates like that. So I did the following:</p><ol><li>Create an empty canvas for processing.</li><li>Using <code>ctx.measureText</code> find the largest font size that fits it.</li><li>Use <code>ctx.fillText</code> to write the text, using white on black for better contrast.</li><li>Read the canvas pixels line by line, looking for white pixels. When found, set up a new particle gravitating towards it.</li></ol><p>In order to allow for different resolution settings I didn&rsquo;t go pixel by pixel, instead I set up increments of <code>resolution</code> pixels, then calculated the average color of them, and compared that to my <code>tolerance</code> threshold.</p><p>The code for this is quite long, so I posted here the relevant parts only:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// Find the largest font size
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>textSize</span>;
</span></span><span style=display:flex><span><span style=color:#66d9ef>do</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>canvas</span>.<span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>font</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;bold &#34;</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>content</span>.<span style=color:#a6e22e>size</span> <span style=color:#f92672>+</span> <span style=color:#e6db74>&#34;px sans-serif&#34;</span>;
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>textSize</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>canvas</span>.<span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>measureText</span>(<span style=color:#a6e22e>content</span>.<span style=color:#a6e22e>text</span>);
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>content</span>.<span style=color:#a6e22e>size</span><span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span>} <span style=color:#66d9ef>while</span> (<span style=color:#a6e22e>textSize</span>.<span style=color:#a6e22e>width</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>canvas</span>.<span style=color:#a6e22e>WIDTH</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>content</span>.<span style=color:#a6e22e>size</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>canvas</span>.<span style=color:#a6e22e>HEIGHT</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Now sweep the canvas finding the text
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>pix</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>canvas</span>.<span style=color:#a6e22e>ctx</span>.<span style=color:#a6e22e>getImageData</span>(<span style=color:#ae81ff>0</span>, <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>canvas</span>.<span style=color:#a6e22e>WIDTH</span>, <span style=color:#a6e22e>canvas</span>.<span style=color:#a6e22e>HEIGHT</span>);
</span></span><span style=display:flex><span><span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>y</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>y</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>pix</span>.<span style=color:#a6e22e>height</span>; <span style=color:#a6e22e>y</span> <span style=color:#f92672>+=</span> <span style=color:#a6e22e>nebula</span>.<span style=color:#a6e22e>settings</span>.<span style=color:#a6e22e>resolution</span>) {
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>x</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>x</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>pix</span>.<span style=color:#a6e22e>width</span>; <span style=color:#a6e22e>x</span> <span style=color:#f92672>+=</span> <span style=color:#a6e22e>nebula</span>.<span style=color:#a6e22e>settings</span>.<span style=color:#a6e22e>resolution</span>) {
</span></span><span style=display:flex><span>        <span style=color:#75715e>// Calculate averages
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>        <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>found</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>false</span>, <span style=color:#a6e22e>auxAvg</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>, <span style=color:#a6e22e>points</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>;
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>x1</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>x1</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>nebula</span>.<span style=color:#a6e22e>settings</span>.<span style=color:#a6e22e>resolution</span>; <span style=color:#a6e22e>x1</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>for</span> (<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>y1</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>y1</span> <span style=color:#f92672>&lt;</span> <span style=color:#a6e22e>nebula</span>.<span style=color:#a6e22e>settings</span>.<span style=color:#a6e22e>resolution</span>; <span style=color:#a6e22e>y1</span><span style=color:#f92672>++</span>) {
</span></span><span style=display:flex><span>                <span style=color:#75715e>// I now have all needed pointers
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#75715e>// Get the index inside pix array
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>pixIndex</span> <span style=color:#f92672>=</span> ((<span style=color:#a6e22e>y</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>y1</span>) <span style=color:#f92672>*</span> <span style=color:#a6e22e>pix</span>.<span style=color:#a6e22e>width</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>x</span> <span style=color:#f92672>+</span> <span style=color:#a6e22e>x1</span>) <span style=color:#f92672>*</span> <span style=color:#ae81ff>4</span>;
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>auxAvg</span> <span style=color:#f92672>+=</span> (<span style=color:#a6e22e>pix</span>.<span style=color:#a6e22e>data</span>[<span style=color:#a6e22e>pixIndex</span>] <span style=color:#f92672>+</span> <span style=color:#a6e22e>pix</span>.<span style=color:#a6e22e>data</span>[<span style=color:#a6e22e>pixIndex</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>1</span>] <span style=color:#f92672>+</span> <span style=color:#a6e22e>pix</span>.<span style=color:#a6e22e>data</span>[<span style=color:#a6e22e>pixIndex</span> <span style=color:#f92672>+</span> <span style=color:#ae81ff>2</span>]) <span style=color:#f92672>/</span> <span style=color:#ae81ff>3</span>;
</span></span><span style=display:flex><span>                <span style=color:#a6e22e>points</span><span style=color:#f92672>++</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>auxAvg</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>auxAvg</span> <span style=color:#f92672>/</span> <span style=color:#a6e22e>points</span>;
</span></span><span style=display:flex><span>            <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>auxAvg</span> <span style=color:#f92672>&gt;</span> <span style=color:#ae81ff>0</span> <span style=color:#f92672>&amp;&amp;</span> <span style=color:#a6e22e>auxAvg</span> <span style=color:#f92672>&lt;</span> <span style=color:#ae81ff>255</span> <span style=color:#f92672>-</span> (<span style=color:#ae81ff>255</span> <span style=color:#f92672>*</span> <span style=color:#a6e22e>nebula</span>.<span style=color:#a6e22e>settings</span>.<span style=color:#a6e22e>tolerance</span>)) {
</span></span><span style=display:flex><span>                <span style=color:#75715e>// Found a valid point
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>                <span style=color:#66d9ef>break</span>;
</span></span><span style=display:flex><span>            }
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>With all this code I have the image before, with all the edges. Now it&rsquo;s just a matter of drawing some particles in random locations, and update their position based on gravity towards the calculated points.</p><p>Here is a live example where you can see the distance from each particle to the point where it wants to go (green), and the force (red):</p><figure><div style=width:100%;height:300px id=edgesDemo></div></figure><p>For this example I set the <code>drag</code> force to 0 so that they would remain moving. Most of the particles&rsquo; behavior can be changed with the settings, which allows for pretty cool effects.</p><p>On the <a href=https://aurbano.github.io/Nebula/>demo page</a> for Nebula you can play with these settings using dat.gui.</p><h2 id=interesting-uses>Interesting uses</h2><p>After playing with the explosions for a while I realized it would be really interesting if I could sync them to an audio track.</p><p>Looking around I found out that Chrome and HTML5 provide an <a href=https://developer.mozilla.org/en-US/docs/Web/API/AnalyserNode>AnalyserNode</a> that does an <a href=http://en.wikipedia.org/wiki/Fast_Fourier_transform>FFT</a> on the audio and gives you the frequency analysis, so I decided to hack that and Nebula together for an <a href=https://aurbano.github.io/Nebula/music.html>awesome visualization experience</a>!</p><p>Setting up the analyser was just too easy:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span>window.<span style=color:#a6e22e>AudioContext</span> <span style=color:#f92672>=</span> window.<span style=color:#a6e22e>AudioContext</span> <span style=color:#f92672>||</span> window.<span style=color:#a6e22e>webkitAudioContext</span> <span style=color:#f92672>||</span> window.<span style=color:#a6e22e>mozAudioContext</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Remember to add this to the HTML:
</span></span></span><span style=display:flex><span><span style=color:#75715e>// &lt;audio id=&#34;explosions&#34; src=&#34;misc/dubstep.mp3&#34; preload=&#34;metadata&#34;&gt;&lt;/audio&gt;
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>audio</span> <span style=color:#f92672>=</span> document.<span style=color:#a6e22e>getElementById</span>(<span style=color:#e6db74>&#39;explosions&#39;</span>),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>audioCtx</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>AudioContext</span>(),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>analyser</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>audioCtx</span>.<span style=color:#a6e22e>createAnalyser</span>(),
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>source</span> <span style=color:#f92672>=</span>  <span style=color:#a6e22e>audioCtx</span>.<span style=color:#a6e22e>createMediaElementSource</span>(<span style=color:#a6e22e>audio</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Connect the analyser to the source
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>source</span>.<span style=color:#a6e22e>connect</span>(<span style=color:#a6e22e>analyser</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// And then the analyser to the destination, if you don&#39;t
</span></span></span><span style=display:flex><span><span style=color:#75715e>// you will analyse the audio but not hear it.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>analyser</span>.<span style=color:#a6e22e>connect</span>(<span style=color:#a6e22e>audioCtx</span>.<span style=color:#a6e22e>destination</span>);
</span></span><span style=display:flex><span><span style=color:#a6e22e>analyser</span>.<span style=color:#a6e22e>smoothingTimeConstant</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>0.3</span>;
</span></span><span style=display:flex><span><span style=color:#75715e>// FFT &#34;resolution&#34;, this specifies the number of samples
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>analyser</span>.<span style=color:#a6e22e>fftSize</span> <span style=color:#f92672>=</span> <span style=color:#ae81ff>512</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Setup frequencyData to hold our information
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>var</span> <span style=color:#a6e22e>frequencyData</span> <span style=color:#f92672>=</span> <span style=color:#66d9ef>new</span> <span style=color:#a6e22e>Uint8Array</span>(<span style=color:#a6e22e>analyser</span>.<span style=color:#a6e22e>frequencyBinCount</span>);
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Not necessary since I set it to autoplay
</span></span></span><span style=display:flex><span><span style=color:#75715e>// left it here in case someone copies this code.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>audio</span>.<span style=color:#a6e22e>play</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// There are different ways to do this, but requestAnimationFrame works great
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>animation</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>requestAnimationFrame</span>(<span style=color:#a6e22e>animation</span>);
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>analyser</span>.<span style=color:#a6e22e>getByteFrequencyData</span>(<span style=color:#a6e22e>frequencyData</span>);
</span></span><span style=display:flex><span>    
</span></span><span style=display:flex><span>    <span style=color:#75715e>// And here I have the frequency data
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#a6e22e>console</span>.<span style=color:#a6e22e>log</span>(<span style=color:#a6e22e>frequencyData</span>);
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>// Start the process
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#a6e22e>animation</span>();
</span></span></code></pre></div><p>The snippet before gives us the array <code>frequencyData</code>, which will contain in this case 512 integers <code>[0, 255]</code> representing in lay man&rsquo;s terms the &ldquo;volume&rdquo; on each frequency.</p><p>Using this it&rsquo;s easy to set up a function that iterates over each frequency, checks if the volume is bigger than a set threshold and if so, triggers an explosion.</p><p>The problem is that most songs are just centered on a low range of frequencies, so in order to have an accurate explosion on each frequency we would need a very big FFT resolution and then take only the first 300 values or so. Since that would be a bit resource intensive, and I only want an interesting visual effect I distribute the explosions randomly whenever any frequency surpases the threshold. At the moment there is no way to set a frequency range on the AnalyserNode.</p><p>Here is the function for this:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-javascript data-lang=javascript><span style=display:flex><span><span style=color:#75715e>// This function should be called where &#39;console.log&#39; is in the other snippet
</span></span></span><span style=display:flex><span><span style=color:#75715e></span><span style=color:#66d9ef>function</span> <span style=color:#a6e22e>frequencyExplode</span>(<span style=color:#a6e22e>freqData</span>){
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>total</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>freqData</span>.<span style=color:#a6e22e>length</span>;
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#75715e>// Divide by 2 because half the data is always 0
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>    <span style=color:#66d9ef>for</span>(<span style=color:#66d9ef>var</span> <span style=color:#a6e22e>i</span><span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>&lt;</span><span style=color:#a6e22e>total</span><span style=color:#f92672>/</span><span style=color:#ae81ff>2</span>; <span style=color:#a6e22e>i</span><span style=color:#f92672>++</span>){
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>if</span>(<span style=color:#a6e22e>freqData</span>[<span style=color:#a6e22e>i</span>] <span style=color:#f92672>&gt;</span> <span style=color:#a6e22e>musicSettings</span>.<span style=color:#a6e22e>freqThreshold</span>){
</span></span><span style=display:flex><span>            
</span></span><span style=display:flex><span>            <span style=color:#75715e>// Random location in the x axis. Without the part after
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#75715e>// the + the explosions would have been exactly on the frequency
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#75715e>// they should, but as I said that wouldn&#39;t work fine because of 
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#75715e>// the spectral distribution of music. Will improve this over time.
</span></span></span><span style=display:flex><span><span style=color:#75715e></span>            <span style=color:#66d9ef>var</span> <span style=color:#a6e22e>x</span> <span style=color:#f92672>=</span> <span style=color:#a6e22e>$</span>(document).<span style=color:#a6e22e>width</span>() <span style=color:#f92672>*</span> <span style=color:#a6e22e>i</span> <span style=color:#f92672>/</span> (<span style=color:#a6e22e>total</span><span style=color:#f92672>/</span><span style=color:#ae81ff>2</span>) <span style=color:#f92672>+</span> <span style=color:#a6e22e>$</span>(document).<span style=color:#a6e22e>width</span>() <span style=color:#f92672>*</span> Math.<span style=color:#a6e22e>random</span>();
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>            <span style=color:#a6e22e>text</span>.<span style=color:#a6e22e>explosion</span>(<span style=color:#a6e22e>x</span>, <span style=color:#a6e22e>$</span>(document).<span style=color:#a6e22e>height</span>()<span style=color:#f92672>*</span>Math.<span style=color:#a6e22e>random</span>());
</span></span><span style=display:flex><span>        }
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Turn up the volume, and take a look at <a href=https://aurbano.github.io/Nebula/music.html>the demo</a> :)</p><script type=text/javascript src=https://aurbano.github.io/Nebula/lib/pixi/bin/pixi.js></script>
<script type=text/javascript src=https://aurbano.github.io/Nebula/src/nebula-pixi.js></script>
<script type=text/javascript>$(document).ready(function(){var t,e=new Nebula({container:$("#nebulaDemo"),showDistance:!1,showForce:!1,showEdges:!1,showNodes:!0,variableLineWidth:!1,resolution:20,drag:.005,drawFn:"rectangle",minRad:5,maxRad:9,bgColor:16119285,blendMode:"NORMAL"});e.write("hey",[7820031,5089008]),$("#nebulaDemo").click(function(t){e.explosion(t.pageX-$(this).offset().left,t.pageY-$(this).offset().top)}),t=new Nebula({container:$("#edgesDemo"),showDistance:!0,showForce:!0,showEdges:!0,showNodes:!1,variableLineWidth:!1,resolution:20,maxSpeed:2,drag:0,drawFn:"rectangle",bgColor:0,blendMode:"NORMAL"}),t.write("force",[7820031])})</script></div><div class="card related shadow"><div class=card-body><h5 class=card-title>More like this:</h5><div class=item><h6><a href=/post/2020-04-13-dotdot/>dotdot: A social experiment</a>
<small class="date text-muted">April 13, 2020</small></h6><p class=text-muted>Group chat application aiming to help meet and get to know other people</p></div><div class=item><h6><a href=/post/2020-02-08-procedural-maps/>Procedural Map Generation</a>
<small class="date text-muted">February 8, 2020</small></h6><p class=text-muted>JavaScript implementation using simplex noise and WebGL rendering</p></div><div class=item><h6><a href=/post/2020-02-15-flocking-simulation/>Flocking Behaviour Simulations</a>
<small class="date text-muted">February 8, 2020</small></h6><p class=text-muted>JavaScript implementation of the Boid algorithm</p></div><div class=item><h6><a href=/post/2015-03-03-front-end-sample/>Using the latest front-end tech</a>
<small class="date text-muted">March 3, 2015</small></h6><p class=text-muted>Sample web I've coded to get the latest front end technologies working together.</p></div><div class=item><h6><a href=/post/2014-10-10-web-visualizer-using-webgl/>Web Visualizer using WebGL</a>
<small class="date text-muted">October 10, 2014</small></h6><p class=text-muted>Building a web visualization tool using some search APIs and VivaGraphJS WebGL renderer</p></div></div></div></div></div></div></main><footer><p class="copyright text-muted"><a href=/>Alejandro U. Alvarez</a>
Â© All rights reserved
&bull;
<a href=/index.xml>RSS</a>
&bull;
<a href=/post>All posts</a>
&bull;
<a href=/categories>Categories</a>
&bull;
<a href=/tags>Tags</a></p></footer><div class="border animated-hue"></div><script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/javascript.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/typescript.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/java.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/haskell.min.js></script>
<script src=https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/languages/bash.min.js></script>
<script>hljs.initHighlightingOnLoad()</script><script src=https://aurbano.eu/vendor/bootstrap/dist/js/bootstrap.bundle.min.js></script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id=MathJax-script async src=https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js></script>
<script>$(document).on("click",function(){$(".collapse").collapse("hide")})</script></body></html>